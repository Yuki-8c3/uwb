# 实验2：嗅探占空比（锚点省电开关）

## 实验目的
仅改锚点RX嗅探窗口，量化**锚点待机功耗**差异。

## 实验配置

### A组（占空小、省电）
- **ON time**: 3 PAC (实际是4 PAC，硬件自动+1)
- **OFF time**: 25 * (128/125) μs ≈ 25.6 μs
- **占空比**: 约较高（ON时间相对OFF时间较长）

### B组（占空更小、更省，但可能漏检）
- **ON time**: 3 PAC (实际是4 PAC，硬件自动+1)
- **OFF time**: 50 * (128/125) μs ≈ 51.2 μs
- **占空比**: 约较低（OFF时间更长，更省电）

## 实验参数

- **每个模式运行时间**: 150秒
- **模式切换延迟**: 10秒
- **记录间隔**: 1秒
- **基线PHY配置**: 6.8Mbps / PRF 64MHz / PL=64 / SFD=standard(8)

## 记录指标

每个测量周期记录以下数据：
- **RSSI**: 接收信号强度指示器
- **RXPACC**: RX前导累积计数器（用于评估接收质量）
- **SNR**: 信噪比
- **RX Count**: 成功接收计数
- **TX Count**: 发送计数
- **Timeout Count**: RX超时计数（指示漏检）
- **Error Count**: RX错误计数（指示漏检）
- **Downlink Bytes**: 下行传输字节数

## 预期结果

- **B组锚点功耗明显下降**（因为OFF时间更长，占空比更低）
- **若出现漏检**：`rxpacc`/丢包会上升，timeout_count和error_count会增加

## 文件结构

```
exp2_sniff_duty/
├── main.c              # 主程序，负责初始化和嗅探模式切换
├── ss_resp_main.c      # SS TWR responder逻辑和数据记录
├── ss_resp_main.h      # 头文件定义
├── UART/               # UART驱动
│   ├── UART.c
│   └── UART.h
└── config/             # SDK配置文件
    └── sdk_config.h
```

## 使用方法

1. 编译项目（使用Keil或SES）
2. 烧录到DWM1001设备（作为锚点/responder）
3. 通过UART观察输出数据
4. 实验将自动在SNIFF模式A和B之间切换
5. 每个模式运行150秒后自动切换到下一个模式

## 输出格式

实验会输出以下信息：
- 模式切换通知和占空比信息
- 每10次成功接收的详细信息
- 每秒的统计摘要
- 模式切换时的完整统计报告（包括漏检情况）

## 注意事项

- 此实验针对**锚点（responder）**，需要配合initiator使用
- 实验开始前确保系统已稳定
- 模式切换期间会有10秒延迟，用于SNIFF模式重配置
- 所有统计数据会在模式切换时打印
- **关键指标**：timeout_count和error_count用于评估漏检情况


